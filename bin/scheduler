#!/usr/bin/env ruby

require File.expand_path(File.join(File.dirname(__FILE__), '..', 'config', 'environment'))
puts "Rails #{Rails.env} environment loaded... checking for waiting updates"

loop do
  Scheduler::Schedule.due_tasks.each do |klass, method_names|
    method_names.each do |method_name, items|
      if items.present?
        print "#{Time.now.strftime('%Y %b %d %k:%M:%S')} - #{klass.to_s}##{method_name}: "

        items.each do |item|
          item.send(method_name)
          print "#{item.id} "
        end

        print "\n"
      end
    end
  end

  sleep 1
end
