#!/usr/bin/env ruby

require File.expand_path(File.join(File.dirname(__FILE__), '..', 'config', 'environment'))
puts "Rails #{Rails.env} environment loaded... checking for waiting updates"

loop do
  Scheduler::Schedule.new(1.hour.ago, 10.minutes.from_now).due_tasks.each do |task|
    print "#{Time.now.strftime('%Y %b %d %k:%M:%S')} - #{task.inspect}: "
    task.perform!
    puts ' - completed'
  end

  sleep 1
end
